!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/bundles/administration/",n(n.s="R63M")}({"FIz/":function(e,t,n){},Gdb8:function(e,t){e.exports='{% block sw_product_detail_base_basic_info_card %}\n    <sw-card title="Product customizer attributes" :isLoading="isLoading">\n        <personal-product-canvas></personal-product-canvas>\n    </sw-card>\n    {% parent() %}\n{% endblock %}\n'},R63M:function(e,t,n){"use strict";n.r(t);var a=n("hOIl"),r=n.n(a);n("uibz");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=Shopware.Component.getComponentHelper(),d=c.mapState,l=c.mapGetters;Shopware.Component.register("personal-product-canvas",{template:r.a,data:function(){return{setPosKey:0}},computed:i(i(i({},d("swProductDetail",["product"])),l("swProductDetail",["isLoading"])),{},{isCustomizable:{get:function(){var e;return console.log(this.product),(null===(e=this.product.customFields)||void 0===e?void 0:e.personal_product_customizable)||!1},set:function(e){this.$set(this.product.customFields,"personal_product_customizable",e),e&&this.initializeCanvas()}},canvasX0:{get:function(){return this.get("X0")},set:function(e){this.set(e,"X0")}},canvasX1:{get:function(){return this.get("X1")},set:function(e){this.set(e,"X1")}},canvasY0:{get:function(){return this.get("Y0")},set:function(e){this.set(e,"Y0")}},canvasY1:{get:function(){return this.get("Y1")},set:function(e){this.set(e,"Y1")}},canvasWidth:{get:function(){return this.canvasX1-this.canvasX0||0},set:function(e){this.canvasX1=this.canvasX0+e}},canvasHeight:{get:function(){return this.canvasY1-this.canvasY0||0},set:function(e){this.canvasY1=this.canvasY0+e}}}),watch:{isLoading:function(e){!e&&this.isCustomizable&&this.initializeCanvas()}},methods:{get:function(e){return this.product.customFields["personal_product_canvas".concat(e)]||0},set:function(e,t){this.$set(this.product.customFields,"personal_product_canvas".concat(t),e),this.updateCanvasRect()},initializeCanvas:function(){var e=this;this.$nextTick((function(){var t=e.product.media.first().media.metaData;e.$refs.canvas.width=t.width,e.$refs.canvas.height=t.height,e.updateCanvasRect()}))},onClickCanvas:function(e){var t=this.$refs.canvas.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top,r=this.$refs.canvas.offsetWidth,s=this.$refs.canvas.offsetHeight,i=this.$refs.canvas.width/r,o=this.$refs.canvas.height/s;this.setPosition(n*i,a*o)},setPosition:function(e,t){this["canvasX".concat(this.setPosKey)]=Math.ceil(e),this["canvasY".concat(this.setPosKey)]=Math.ceil(t),this.setPosKey=+!this.setPosKey},updateCanvasRect:function(){var e=this,t=this.$refs.canvas.getContext("2d");t.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height);var n=new Image;n.onload=function(){t.drawImage(n,0,0),t.fillStyle="rgba(69,55,194,0.4)",t.fillRect(e.canvasX0,e.canvasY0,e.canvasX1-e.canvasX0,e.canvasY1-e.canvasY0)},n.src=this.product.media.first().media.url},onClickReset:function(){this.canvasX0=0,this.canvasX1=0,this.canvasY0=0,this.canvasY1=0,this.setPosKey=0,this.updateCanvasRect()}}});var u=n("Gdb8"),p=n.n(u);Shopware.Component.override("sw-product-detail-base",{template:p.a});var f=n("nfCc"),v=n.n(f);Shopware.Component.override("sw-order-line-items-grid",{template:v.a,data:function(){return{personalProduct:!1}}});var h=n("eUFZ"),m=n.n(h),g=(n("a1i4"),Shopware),b=g.Component,w=g.Context,_=Shopware.Data.Criteria;b.register("personal-product-preview-modal",{template:m.a,inject:["repositoryFactory"],props:{productId:{required:!0,type:String},imageUrl:{required:!0,type:String}},data:function(){return{product:null}},computed:{productRepository:function(){return this.repositoryFactory.create("product")}},created:function(){this.createdComponent()},methods:{createdComponent:function(){var e=this,t=new _;t.setIds([this.productId]),t.addAssociation("media"),this.productRepository.search(t,w.api).then((function(t){e.product=t.first(),e.$nextTick((function(){return e.drawCanvas()}))}))},drawCanvas:function(){var e=this,t=this.product.media.first().media.metaData;this.$refs.canvas.width=t.width,this.$refs.canvas.height=t.height;var n=this.$refs.canvas.getContext("2d");n.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height);var a=this.product.customFields,r=new Image,s=new Image;r.onload=function(){n.drawImage(r,0,0),s.src=e.imageUrl},s.onload=function(){n.drawImage(s,a.personal_product_canvasX0,a.personal_product_canvasY0,a.personal_product_canvasX1-a.personal_product_canvasX0,a.personal_product_canvasY1-a.personal_product_canvasY0)},r.src=this.product.media.first().media.url}}})},SZ7m:function(e,t,n){"use strict";function a(e,t){for(var n=[],a={},r=0;r<t.length;r++){var s=t[r],i=s[0],o={id:e+":"+r,css:s[1],media:s[2],sourceMap:s[3]};a[i]?a[i].parts.push(o):n.push(a[i]={id:i,parts:[o]})}return n}n.r(t),n.d(t,"default",(function(){return v}));var r="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!r)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var s={},i=r&&(document.head||document.getElementsByTagName("head")[0]),o=null,c=0,d=!1,l=function(){},u=null,p="data-vue-ssr-id",f="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function v(e,t,n,r){d=n,u=r||{};var i=a(e,t);return h(i),function(t){for(var n=[],r=0;r<i.length;r++){var o=i[r];(c=s[o.id]).refs--,n.push(c)}t?h(i=a(e,t)):i=[];for(r=0;r<n.length;r++){var c;if(0===(c=n[r]).refs){for(var d=0;d<c.parts.length;d++)c.parts[d]();delete s[c.id]}}}}function h(e){for(var t=0;t<e.length;t++){var n=e[t],a=s[n.id];if(a){a.refs++;for(var r=0;r<a.parts.length;r++)a.parts[r](n.parts[r]);for(;r<n.parts.length;r++)a.parts.push(g(n.parts[r]));a.parts.length>n.parts.length&&(a.parts.length=n.parts.length)}else{var i=[];for(r=0;r<n.parts.length;r++)i.push(g(n.parts[r]));s[n.id]={id:n.id,refs:1,parts:i}}}}function m(){var e=document.createElement("style");return e.type="text/css",i.appendChild(e),e}function g(e){var t,n,a=document.querySelector("style["+p+'~="'+e.id+'"]');if(a){if(d)return l;a.parentNode.removeChild(a)}if(f){var r=c++;a=o||(o=m()),t=_.bind(null,a,r,!1),n=_.bind(null,a,r,!0)}else a=m(),t=y.bind(null,a),n=function(){a.parentNode.removeChild(a)};return t(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;t(e=a)}else n()}}var b,w=(b=[],function(e,t){return b[e]=t,b.filter(Boolean).join("\n")});function _(e,t,n,a){var r=n?"":a.css;if(e.styleSheet)e.styleSheet.cssText=w(t,r);else{var s=document.createTextNode(r),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(s,i[t]):e.appendChild(s)}}function y(e,t){var n=t.css,a=t.media,r=t.sourceMap;if(a&&e.setAttribute("media",a),u.ssrId&&e.setAttribute(p,t.id),r&&(n+="\n/*# sourceURL="+r.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},WqYv:function(e,t,n){},a1i4:function(e,t,n){var a=n("FIz/");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("5c89f687",a,!0,{})},eUFZ:function(e,t){e.exports='{% block personal_product_preview_modal %}\n    <sw-modal title="Preview" variant="large" class="personal-product-preview-modal" @modal-close="$emit(\'modal-close\')">\n        <template v-if="product">\n            <div class="media-canvas-outer">\n                <div class="media-canvas-inner">\n                    <canvas ref="canvas" class="canvas"></canvas>\n                </div>\n            </div>\n        </template>\n    </sw-modal>\n{% endblock %}\n'},hOIl:function(e,t){e.exports='{% block personal_product_attributes %}\n    <div v-if="!isLoading" class="personal-product-canvas">\n        <sw-switch-field\n            label="Customizable product"\n            v-model="isCustomizable">\n        </sw-switch-field>\n\n        <sw-container columns="2fr 1fr" v-if="isCustomizable">\n            <div class="media-canvas-outer">\n                <div class="media-canvas-inner">\n                    <canvas ref="canvas" class="canvas" @click="onClickCanvas"></canvas>\n                </div>\n            </div>\n\n            <div>\n                <sw-number-field\n                    label="Canvas X0"\n                    v-model="canvasX0">\n                </sw-number-field>\n\n                <sw-number-field\n                    label="Canvas Y0"\n                    v-model="canvasY0">\n                </sw-number-field>\n\n                <sw-number-field\n                    label="Canva Width"\n                    v-model="canvasWidth">\n                </sw-number-field>\n\n                <sw-number-field\n                    label="Canvas Height"\n                    v-model="canvasHeight">\n                </sw-number-field>\n\n                <sw-button @click="onClickReset" variant="primary">\n                    Reset\n                </sw-button>\n            </div>\n        </sw-container>\n    </div>\n{% endblock %}\n'},nfCc:function(e,t){e.exports='{% block sw_order_line_items_grid_grid_columns_label_content %}\n    {% parent() %}\n    <span v-if="item.payload.url">&nbsp;- Customized</span>\n{% endblock %}\n\n{% block sw_order_line_items_grid_grid_columns_label_link %}\n    <router-link v-else-if="!isInlineEdit && item.payload.url"\n                 :title="$tc(\'sw-order.detailBase.contextMenuShowProduct\')"\n                 :to="{ name: \'sw.product.detail\', params: { id: item.referencedId } }">\n            {{ item.label }}\n    </router-link>\n    {% parent() %}\n{% endblock %}\n\n\n{% block sw_order_line_items_grid_grid_actions_show %}\n    <template v-if="item.payload.url">\n        <sw-context-menu-item :disabled="item.type !== \'product\'"\n                              icon="default-eye-open"\n                              :routerLink="{ name: \'sw.product.detail\', params: { id: item.referencedId } }">\n            {{ $tc(\'sw-order.detailBase.contextMenuShowProduct\') }}\n        </sw-context-menu-item>\n        <sw-context-menu-item icon="default-eye-open" @click="personalProduct = item">\n            Show preview\n        </sw-context-menu-item>\n    </template>\n    <template v-else>\n        {% parent() %}\n    </template>\n{% endblock %}\n\n{% block sw_order_line_items_grid_grid %}\n    {% parent() %}\n\n    <personal-product-preview-modal v-if="personalProduct"\n                                    :productId="personalProduct.referencedId"\n                                    :imageUrl="personalProduct.payload.url"\n                                    @modal-close="personalProduct = false">\n    </personal-product-preview-modal>\n{% endblock %}\n'},uibz:function(e,t,n){var a=n("WqYv");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("1dfd2bfb",a,!0,{})}});